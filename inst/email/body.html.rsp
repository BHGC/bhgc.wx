<%---
# Example:
# Rscript -e R.rsp::rcat --args --file=wx.md.rsp --timestamp="2020-10-08T13:26:25-07:00" --wfo="mtr" --imgfile="imgs/lakecourt,2020-10-10T15_02_14-07_00,mtr.png" --label="Blue Rock, Vallejo, CA" --lat="38.1384" --lon="-122.1956"

# Input arguments
timestamp <- R.utils::cmdArg("timestamp")
imgfile <- R.utils::cmdArg("imgfile")
label <- toupper(R.utils::cmdArg("label", ""))
lat <- toupper(R.utils::cmdArg("lat", NA_real_))
lon <- toupper(R.utils::cmdArg("lon", NA_real_))
wfo <- toupper(R.utils::cmdArg("wfo", ""))
---%>

<%
stopifnot(utils::file_test("-f", imgfile))
stopifnot(nzchar(label))
stopifnot(!is.na(lat))
stopifnot(!is.na(lon))
stopifnot(nchar(wfo) == 3L)
pattern <- "(.*)T(.*)([-+].*)"
stopifnot(grepl(pattern, timestamp))
date <- gsub(pattern, "\\1", timestamp)
time <- gsub(pattern, "\\2", timestamp)
utc  <- gsub(pattern, "\\3", timestamp)
%>

New NOAA weather forecast for <%= label %> at <%= format(timestamp, format = "%T") %> on <%= format(timestamp, format = "%F") %> (UTC <%= format(timestamp, format = "%z") %>) by the <%= wfo %> office.

<img src="<%= blastula:::get_image_uri(imgfile) %>"/><br>

<a href="https://forecast.weather.gov/MapClick.php?w0=t&w1=td&w2=wc&w3=sfcwind&w4=sky&w5=pop&w6=rh&w7=thunder&w8=rain&Submit=Submit&&site=mtr&bw=0&textField1=<%= lat %>&textField2=<%= lon %>&AheadHour=0&FcstType=graphical">Graphical</a>

<a href="https://forecast.weather.gov/MapClick.php?w0=t&w1=td&w2=wc&w3=sfcwind&w4=sky&w5=pop&w6=rh&w7=thunder&w8=rain&Submit=Submit&&site=mtr&bw=0&textField1=<%= lat %>&textField2=<%= lon %>&AheadHour=0&FcstType=digital">Digital</a>
   
<a href="https://forecast.weather.gov/product.php?site=<%= wfo %>&issuedby=<%= wfo %>&product=AFD&format=TXT&glossary=1">Area Forecast Discussion</a>
